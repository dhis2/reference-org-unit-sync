name: reference-org-unit-sync-test
description: Verify Org Unit Sync Camel route
actions:
  - groovy:
      beans:
        script: |
          beans {
            connectionFactory(org.apache.activemq.artemis.jms.client.ActiveMQConnectionFactory.class) {
              brokerURL = "tcp://localhost:61616"
            }
          }
  - camel:
      jbang:
        camelVersion: 4.10.0
        run:
          resources:
            - "application.properties"
          integration:
            name: "reference-org-unit-sync"
            file: "../route.camel.yaml"
            systemProperties:
              file: "application.test.properties"
          dumpIntegrationOutput: true
  - camel:
      startContext: {}
  - send:
      endpoint: |
        camel:dhis2:post/resource?inBody=resource&path=organisationUnits&username=admin&password=district&baseApiUrl=http://localhost:8080/api
      message:
        body:
          resource:
            file: body.json
  - receive:
      endpoint: |
          camel:dhis2:get/resource?path=organisationUnits/b7HFMWjj3im&username=admin&password=district&baseApiUrl=http://localhost:8081/api
#      process:
      #        body:
      #          data: |
      #            {}
#      validate:
#        - script:
#            type: groovy
#            value: assert receivedMessage.getPayload(String.class).contains("Hello Citrus!")
#  - camel:
#      jbang:
#        verify:
#          maxAttempts: 3
#          integration: reference-org-unit-sync
#          logMessage: Successfully synced org unit
#          delayBetweenAttempts: 50000
#          printLogs: true