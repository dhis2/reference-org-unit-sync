- route:
    id: syncOrgUnitRoute
    description: |
      Transforms the org unit resource into a metadata import payload before continuing with the synchronisation 
      operation.
    routeConfigurationId: deadLetterQueueRouteConfig
    from:
      uri: direct:organisationunit
      steps:
        - log: "Preparing to sync org unit [${variables.id}]..."
        - choice:
            when:
              - simple: ${headers.DebeziumOperation} != 'd'
                description: Executes rule for non-delete synchronisations
                steps:
                  - unmarshal:
                      description: Deserialises the JSON resource into a `java.util.Map`.
                      json: { }
        - transform:
            description: Converts the message body into a metadata import payload.
            datasonnet:
              outputMediaType: application/x-java-object
              resultType: java.util.Map
              bodyMediaType: application/x-java-object
              expression: resource:classpath:datasonnet/orgUnit.ds
        - to:
            description: Continues the synchronisation operation.
            uri: direct:sync