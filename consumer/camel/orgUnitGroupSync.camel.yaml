- route:
    id: syncOrgUnitGroupRoute
    description: |
      Transforms the org unit group into a metadata import payload.
    routeConfigurationId: deadLetterQueueRouteConfig
    from:
      uri: direct:orgunitgroup
      steps:
        - filter:
            simple: ${headers.DebeziumOperation} != 'd'
        - unmarshal:
            json: { }
        - setVariable:
            name: orgUnitGroup
            simple: ${body}
        - log: "Syncing create/update for org unit group [${variables.id}]..."
        - split:
            shareUnitOfWork: true
            method:
              beanType: "TargetsSplitter"
              method: "split"
            steps:
              - setVariable:
                  name: target
                  simple: ${body}
              - transform:
                  datasonnet:
                    outputMediaType: application/x-java-object
                    resultType: java.util.Map
                    bodyMediaType: application/x-java-object
                    expression: resource:classpath:datasonnet/orgUnitGroup.ds
              - to: direct:sync