- route:
    id: dhis2TargetRoute
    routeConfigurationId: deadLetterQueueRouteConfig
    logMask: true
    from:
      uri: direct:dhis2Target
      steps:
        - setHeader:
            name: CamelDhis2.queryParams
            groovy: "['importStrategy': 'CREATE_AND_UPDATE', 'idScheme': exchangeProperty.target['idScheme']]"
        - toD:
            uri: dhis2:post/resource
            parameters:
              path: metadata
              username: ${exchangeProperty.target['dhis2ApiUsername']}
              password: ${exchangeProperty.target['dhis2ApiPassword']}
              baseApiUrl: ${exchangeProperty.target['dhis2ApiUrl']}
        - unmarshal:
            json: { }
        - choice:
            when:
              - simple: "${body['status']} == 'SUCCESS' || ${body['status']}  == 'OK'"
                steps:
                  - log:
                      message: Successfully synced resource [${exchangeProperty.id}] with target server [${exchangeProperty.target['dhis2ApiUrl']}]
                      loggingLevel: INFO
            otherwise:
              steps:
                - throwException:
                    message: "Error while syncing resource [${exchangeProperty.id}] with target server [${exchangeProperty.target['dhis2ApiUrl']}]: ${body}"
                    exceptionType: java.lang.Exception