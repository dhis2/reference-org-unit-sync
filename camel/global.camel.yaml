# sets up an error handler policy to capture failed synchronisations in a dead letter queue
- routeConfiguration:
    id: deadLetterQueueRouteConfig
    errorHandler:
      deadLetterChannel:
        redeliveryPolicy:
          redeliveryDelay: "{{deadLetterChannel.redeliveryDelay:1000}}"
          maximumRedeliveries: "{{deadLetterChannel.maximumRedeliveries:3}}"
          useExponentialBackOff: "{{deadLetterChannel.useExponentialBackOff:true}}"
          logExhaustedMessageHistory: true
        deadLetterUri: "{{deadLetterChannel.deadLetterUri:jms:queue:DLQ}}"
        useOriginalMessage: true
        onPrepareFailureRef: "{{deadLetterChannel.onPrepareFailureRef:#class:DeadLetterQueueProcessor}}"

# configures the data source to the source DHIS2 database
- beans:
    - name: dataSource
      properties:
        databaseName: "{{source.dhis2DatabaseDbName}}"
        user: "{{source.dhis2DatabaseUser}}"
        password: "{{source.dhis2DatabasePassword}}"
        portNumber: "{{source.dhis2DatabasePort}}"
        serverName: "{{source.dhis2DatabaseHostname}}"
      type: org.postgresql.ds.PGSimpleDataSource