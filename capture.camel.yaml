- route:
    id: captureChangeRoute
    logMask: true
    from:
      uri: debezium-postgres:dhis2
      parameters:
        databaseHostname: "{{source.dhis2DatabaseHostname}}"
        databasePort: "{{source.dhis2DatabasePort}}"
        databaseUser: "{{source.dhis2DatabaseUser}}"
        databasePassword: "{{source.dhis2DatabasePassword}}"
        databaseDbname: "{{source.dhis2DatabaseDbName}}"
        offsetStorageFileName: data/offset.dat
        topicPrefix: dhis2
        pluginName: pgoutput
        tableIncludeList: "{{source.tableIncludeList:public.organisationunit,public.deletedobject,public.orgunitgroup,public.orgunitgroupset}}"
        columnIncludeList: ".*"
        schemaIncludeList: public
        slotName: slot1
      steps:
        - filter:
            simple: ${body.schema.field('klass')} == null || ${body.get('klass')} == 'OrganisationUnit'
        - log:
            loggingLevel: INFO
            message: "Capturing database change [${headers}]..."
        - setHeader:
            name: DebeziumOperation
            header: CamelDebeziumOperation
        - setHeader:
            name: DebeziumIdentifier
            header: CamelDebeziumIdentifier
        - setBody:
            simple: ${body.get('uid')}
        - to: jms:queue:sync